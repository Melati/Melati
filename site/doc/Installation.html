<HTML>
<HEAD>
<TITLE> org.melati Installation Guide (document $Revision$) </TITLE>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso8859-1">
</HEAD>
<BODY BGCOLOR=#FFFFFF>

<H1><TT>org.melati</TT> Installation Guide (document $Revision$)</H1>

<P>
  This document describes how to install the system on a new machine.
  See also the system's <A HREF=QA.html>master QA document</A>, and
  its <A HREF=Administration.html>administration guide</A>.
</P>




<H2>
<!-- *************** -->
      Prerequisites
<!-- *************** -->
</H2>



<H3>
<!-- ========== -->
      Hardware
<!-- ========== -->
</H3>

<P>
  Since Melati is written entirely in Java, it is portable relatively easily to
  any machine which supports the JVM mentioned below.  However, at the moment
  you probably need a Linux/Pentium box.  You'll probably need at least 64Mb of
  memory to run Postgres, Apache, Java for Webmacro/Melati, X and Netscape all
  at the same time.
</P>



<H3>
<!-- ========== -->
      Software
<!-- ========== -->
</H3>

<P> The pre-alpha snapshot of Melati has been developed against the following 
  software: </P>

<UL>
  <LI> Linux 2.0.34/i586 with glibc 2.0.7 (probably noncritical) 
  <LI> Apache 1.3.3, with JServ 1.0b2 (note that RedHat 5.x Apache RPMs make it 
    hard for you to get JServ working) 
  <LI>Blackdown JDK 1.1.7a. 
  <LI> IBM Jikes Compiler 
  <LI> JSDK (servlet development kit) 2.0 
  <LI> Webmacro Snapshot 1999-12-22 
</UL>

<P>
  Everything up to here could be summarised as: a working webmacro
  installation.  Finally,
</P>

<UL>
  <LI> Postgres 6.4.2 (6.5 may be better since there is at least one known
       problem with 6.4.2: it does not honour <TT>NOT NULL</TT> in
       <TT>ALTER</TT> <TT>TABLE</TT> <TT>ADD</TT> <TT>COLUMN</TT>)
</UL>

<P> The JDBC facilities used by Melati are pretty simple, and we are aiming for 
  compatibility with any DBMS which supports JDBC and transactions, but you know 
  how it is ... </P>
<P>Additionally, Melati has been proved to work with the following software:</P>
<ul>
  <li>Postgres 6.5.2</li>
  <li>IBM 1.1.8 JIT</li>
</ul>




<H2>
<!-- ****************** -->
      Obtaining Melati
<!-- ****************** -->
</H2>

<P>
  You can get a pre-alpha snapshot of Melati from
  <A HREF=http://melati.org><TT>http://melati.org</TT></A>.
</P>




<H2>
<!-- ************** -->
      Implications
<!-- ************** -->
</H2>



<H3>
<!-- ================================= -->
      Interations with other software
<!-- ================================= -->
</H3>

<P>
  Melati interacts with other software in the following ways which you should
  know about:
</P>

<UL>
  <LI> you will have to restart your Melati application (<I>e.g.</I> with
       <TT>apachectl</TT> <TT>graceful</TT>) if Postgres goes down while it is
       running
</UL>



<H3>
<!-- =============== -->
      Risk analysis
<!-- =============== -->
</H3>

<P>
  The things that might be broken if you install the system on a computer are:
</P>

<UL>
  <LI> Database corruption.  Do not let Melati connect to a database whose
       contents you value!

  <LI> Insecurity.  Although Melati provides a user authorisation and access
       control system, it isn't supposed to be indefeasible by the application
       programmer, and anyway it probably doesn't work yet.

  <LI> Bugginess.  Do not use Melati for anything important.
</UL>




<H2>
<!-- ************** -->
      Installation
<!-- ************** -->
</H2>



<H3>
<!-- ============== -->
      Step by step
<!-- ============== -->
</H3>

<P> It is assumed that you already have a working installation of Webmacro (<I>i.e.</I> 
  web server, servlet runner, and Webmacro classes), and a working installation 
  of Postgres or, presuming compatibility, another RDBMS. </P>
<table width="0%" border="0" cellpadding="10" cellspacing="10">
  <tr> 
    <td valign="top">1.</td>
    <td>Set up a database for use by Melati. With Postgres this involves typing, 
      for example, <tt>createdb melatitest</tt> at the Linux prompt, as a user 
      who is allowed to create databases. </td>
  </tr>
  <tr> 
    <td valign="top">2.</td>
    <td>Arrange for the user in whose name your httpd runs---often, `<tt>nobody</tt>'---to 
      be able to connect to the test database and create tables in it. With Postgres 
      this is a no-op under the default `security' setup, assuming that your postmaster 
      is running on the same machine as your web server. </td>
  </tr>
  <tr> 
    <td valign="top">3.</td>
    <td><a name=hackedVariable>Using anonymous CVS, install the Melati source 
      tree somewhere. You also have to install a specially hacked version of <tt>org.webmacro.engine.Variable</tt>. 
      We are very sorry about this, but there really is no alternative---lobby 
      Justin to stop making everything <tt>final</tt> and/or package-private!</a> 
      For instance, 
      <blockquote> 
        <pre>
$ cvs -d :pserver:anonymous@melati.org:/usr/cvsroot login
(Logging in to anonymous@melati.org)
CVS password: anonymous
$ cvs -d :pserver:anonymous@melati.org:/usr/cvsroot checkout org/melati org/webmacro
</pre>
      </blockquote>
      Thereafter you will be able to get an updated snapshot by <tt>cd</tt>ing 
      to the Melati source tree and doing 
      <blockquote> 
        <pre>
$ cvs update
</pre>
      </blockquote>
      (CVS remembers the server from which the tree came in the control files 
      in the <tt>CVS</tt> subdirectories it creates, and the login/password you 
      gave in a file <tt>.cvspass</tt> in your home directory.) If you are working 
      over a slow link, you might find the <a
    href=http://rsync.samba.org/rsync/><tt>rsync</tt></a> program useful: it uses 
      clever checksum tricks, compression and pipelining to perform file comparison 
      and update quicker than you would think possible. Let us know if you would 
      like &quot;anonymous rsync&quot; access. </td>
  </tr>
  <tr> 
    <td valign="top">4.</td>
    <td>Ensure that the following is in your classpath. <br>
      <ul>
        <li>Java (classes.zip)
        <li>ApacheJServ.jar 
        <li>jsdk.jar 
        <li>the melati install directory, <b>before</b> the webmacro install directory 
          (because of the <a
      href=#hackedVariable>hacked version of <tt>Variable</tt></a> you must use) 
        <li>the webmacro install directory 
      </ul>
      <p>For example (on Linux boxes running a bash shell) this can be done by 
        editing ~/.bash_profile, and adding the line: 
      <blockquote> 
        <pre>CLASSPATH=.:/usr/local/packages/jdk117_v3/lib/classes.zip:/usr/local/lib/ApacheJServ.jar:/usr/local/lib/jsdk.jar:/usr/local/packages/inst/melati-0.0.x/:/usr/local/packages/inst/webmacro/webmacro.jar</pre>
        <p>You will need to add CLASSPATH to the export line in ~/.bash_profile, 
          so it sould read something like: </p>
        <pre>export USERNAME BASH_ENV PATH CLASSPATH</pre>
        <p>You will need to run</p>
        <pre>source ~/.bash_profile</pre>
        <p>in order to load the new CLASSPATH into you current environment settings. 
          Check the CLASSPATH has been set by typing </p>
        <pre>echo $CLASSPATH</pre>
      </blockquote>
      <p>&nbsp;</p>
    </td>
  </tr>
  <tr> 
    <td valign="top">5.</td>
    <td>
      <p>Compile melati. </p>
      <p>You need a FULLY compliant Java compiler for JDK 1.1.7 or better. Please 
        note that Sun's "javac" and compiler derived form it do not fulfil this 
        requirement, as JDK 1.1 javac has a known bug with respect to blank final 
        variables. Hopefully this will be fixed in Java2/JD1.2--in the meantime 
        you can use IBM's jikes compiler, which IS fully compliant with the Java 
        specification. </p>
      <p>For instance, </p>
      <blockquote> 
        <pre>
cd /usr/local/packages/inst/melati-0.0.x/org/melati
jikes admin/Admin.java poem/prepro/DSD.java poem/PoemDatabase.java</pre>
      </blockquote>
      ---those three files being entry points to respectively the admin system, 
      and the DSD preprocessor and a class named in the <a
    href=#config>config</a> file---which should cause everything to get compiled 
      (except for a few sources not currently in use). </td>
  </tr>
  <tr> 
    <td valign="top" height="111">6.</td>
    <td height="111"> 
      <p>Arrange for Melati's classes to be accessible to your servlet runner. 
      </p>
      <blockquote> 
        <p>For Apache Jserv, this can be done eithier in the <tt>jserv.properties</tt> 
          file, by adding a line </p>
        <blockquote> 
          <pre>
wrapper.classpath=/usr/local/packages/inst/melati-0.0.x
</pre>
        </blockquote>
        <p>or in your <tt>&lt;zone&gt;.properties</tt> file by adding </p>
        <blockquote> 
          <pre>/usr/local/packages/inst/melati-0.0.x</pre>
        </blockquote>
        <p>to the line beginning <tt>repositories=</tt></p>
        <p>&nbsp;</p>
      </blockquote>
    </td>
  </tr>
  <tr> 
    <td valign="top" height="111">7.</td>
    <td height="111">Get Melati's Webmacro templates into Webmacro's template 
      path. Melati looks for its templates relative to <tt>org/melati</tt> in 
      its source tree, so you should edit your <tt>WebMacro.properties</tt> to 
      say something like 
      <blockquote> 
        <pre>TemplatePath = /usr/local/packages/inst/melati-0.0.x/org/melati:/home/me/templates</pre>
      </blockquote>
    </td>
  </tr>
  <tr> 
    <td valign="top" height="111">8.</td>
    <td height="111"><a name=config>Edit Melati's own config file</a>, found in 
      the source tree as <tt>org/melati/org.melati.LogicalDatabase.properties</tt>, 
      which describes the mapping from &quot;logical database names&quot; to JDBC 
      connection details. You may not have to change anything.</td>
  </tr>
  <tr> 
    <td valign="top" height="111">9.</td>
    <td height="111">Restart your Servlet Runner, typically you will need to kick 
      apache using <tt>apachectl restart</tt>.</td>
  </tr>
  <tr>
    <td valign="top" height="111">10.</td>
    <td height="111">
      <p>To check that Melati is working, try looking at </p>
      <blockquote> 
        <pre>
http://localhost/&lt;servlet zone&gt;/org.melati.admin.Admin/melatitest/View
</pre>
      </blockquote>
      <p> After a long pause (up to twenty seconds on my 100MHz Pentium with too 
        little memory), you should see a list of tables in the <tt>melatitest</tt> 
        database. </p>



</td>
  </tr>
</table>
<P>&nbsp; </P>
<P>&nbsp; </P>

<H3>
<!-- ================= -->
      Troubleshooting
<!-- ================= -->
</H3>

<P>
  If something doesn't work, sorry!  Drop us an email at
  <A HREF=mailto:melati@messageboards.paneris.org>melati@messageboards.paneris.org</A>
  or <A HREF=mailto:williamc@paneris.org>williamc@paneris.org</A>.
</P>




<H2>
<!-- ******************************** -->
      Appendix: building from source
<!-- ******************************** -->
</H2>

<P>
  N/A at this stage.
</P>




<HR>

<H2>
<!-- ********************* -->
      About this document
<!-- ********************* -->
</H2>



<H3>
<!-- ========= -->
      Authors
<!-- ========= -->
</H3>

<P>
  <A HREF=mailto:williamc@paneris.org>William Chesters
  &lt;williamc@paneris.org&gt;</A>
</P>

<P>
  Most recent CVS $Author$ @paneris.org
</P>



<H3>
<!-- ========= -->
      Quality
<!-- ========= -->
</H3>

<P>
  The current quality level of this document is: <B>Personal</B>.  It's not
  finished.
</P>



<H3>
<!-- ======================== -->
      Readership and purpose
<!-- ======================== -->
</H3>

<UL>
  <LI> The <B>customer's admins</B> should know how to install the system from
       scratch on a new computer.

  <LI> So should <B>future developers</B>.
</UL>

<P>
  However, at present this document is primary intended to help the wider
  <B>open source community</B> get Melati running, so that they can give us
  feedback pre-release and evaluate the finished product in an informed manner.
</P>



<H3>
<!-- ========= -->
      History
<!-- ========= -->
</H3>

<P>
  The important points in the life of this document are listed
  below.
</P>

<TABLE>
  <TR><TH>Date</TH><TH>Event</TH></TR>
  <TR>
    <TD>(not yet)</TD>
    <TD>Certified at release quality level by ...</TD>
  </TR>
</TABLE>

<P>
  The CVS log for this document is:
  <BR>
  <BR>$Log$
  <BR>Revision 1.13  2000/03/22 13:44:27  timj
  <BR>more info about jikes, and better jserv classpath setting info
  <BR>
  <BR>Revision 1.12  2000/03/22 12:57:28  timj
  <BR>give an example of correctly setting the classpath
  <BR>
  <BR>Revision 1.11  2000/03/20 17:13:34  williamc
  <BR>Add comments about what to do after cvs checkout
  <BR>
  <BR>Revision 1.10  2000/03/08 11:44:36  williamc
  <BR>Add comments about hacked version of Variable
  <BR>
  <BR>Revision 1.9  2000/03/06 08:35:47  timj
  <BR>stop refering to webmacro.jar
  <BR>
  <BR>Revision 1.8  2000/03/05 21:57:57  timj
  <BR>fix little bits as per problems encountered when i did my 1st install
  <BR>
  <BR>Revision 1.7  2000/03/01 11:45:35  timj
  <BR>explicitly identify what needs to be in the classpath in order to compile
  <BR>
  <BR>Revision 1.6  2000/02/29 09:53:02  williamc
  <BR>Finish recovering from disaster; point out in the docs that you can 'add methods to table rows'
  <BR>
  <BR>
</P>


</BODY>
</HTML>
