<html><head>

<title>Melati Release Notes</title>

</head>



<body bgcolor="white">
<blockquote> 
  <h1 align="center">The Melati Project </h1>
  <h3 align="center">Release Notes </h3>
  <h4 align="center">last updated 11/06/2002 - timp@paneris.org</h4>

  <h4 align="center">Release 0.6.1</h4>
  <h2 align="left">Release 0.6.1</h2>
  <h4 align="left">11/06/2002</h4>
  <ul>
    <li>Support for MckoiDB </li>
    <li>Support for HSQLDB  </li>
    <li>Bundling of jetty and hsqldb </li>
    <li>Website improvements </li>
    <li>Ant build improvements </li>
  </ul>
  <p>
   The template path convention has been changed, so that there is no
   need to have <tt>org/melati</tt> in your classpath. Thsi is because
   both WebMacro and Velocity now default to a classpath template
   loader.
   This change should make no difference to existing installation.
  </p>
  <p>
  the major change is the bundling of Jetty and HSQLDB with the
  distribution as a step towards a Melati Developer's Kit.
  </p>
  <hr>
  <h4 align="center">Release 0.6.0</h4>
  <h2 align="left">Release 0.6.0</h2>
  <h4 align="left">19/04/2002</h4>
  <ul>
    <li>Support for MySQL </li>
  </ul>
  <hr>
  <h4 align="center">Release 0.55.6</h4>
  <h2 align="left">Release 0.55.6</h2>
  <h4 align="left">01/03/2002</h4>
  <ul>
    <li>Add Tree rendering to Admin </li>
    <li>Tidy JSStatic tree</li>
    <li>Incidently added support for MySQL, but this requires testing
    prior to 0.6.0 release</li>
  </ul>
  <hr>
  <h4 align="center">Release 0.55.5</h4>
  <h2 align="left">Release 0.55.5</h2>
  <h4 align="left">15/02/2002</h4>
  <ul>
    <li>Improve Admin frame handling </li>
    <li>Add edit links for Reference Type objects in Admin</li>
    <li>Add JSStatic tree</li>
  </ul>
  <hr>
  <h4 align="center">Release 0.55.4</h4>
  <h2 align="left">Release 0.55.4</h2>
  <h4 align="left">17/12/2001</h4>
  <ul>
    <li>improve connection pending error message</li>
  </ul>
  <hr>
  <h2 align="left">Release 0.55.3</h2>
  <h4 align="left">18/09/2001</h4>
  <ul>
    <li>Add javascript email validation</li>
    <li>when extracting fields, trim whitespace from values. This allows users 
      to enter '19 ' in an integer field, and not generate an error. </li>
    <li>fix trailing / for upload in ConfigServletTest</li>
    <li>allow melati to run from an IP address under jserv</li>
  </ul>
  <hr>
  <h2 align="left"></h2>
  <h2 align="left">Release 0.55.2</h2>
  <h4 align="left">17/08/2001</h4>
  <ul>
    <li>Adds a 'remember me' feature to login. This stores the user's password 
      in the cookie.</li>
  </ul>
  <hr>
  <h2 align="left">Release 0.55.1</h2>
  <h4 align="left">25/07/2001</h4>
  <p align="left">This is a minor maintenance release that fixes problems with 
    uploading items for objects that don't yet exist.</p>
  <hr>
  <h2></h2>
  <h2></h2>
  <h4>12/07/2001 </h4>
  <ul>
    <li>support for JSDK 2.2, specifically Tomcat </li>
    <li>modifications to the upload process, allowing access to the Melati / MelatiContext</li>
    <li>Improvements to error handling</li>
  </ul>
  <h3>JSDK 2.2 / Tomcat</h3>
  <p>If you only want to install one melati, but would like to run several contexts 
    (analog of servlet zone), you should copy or make softlink of melati dir to 
    WEB-INF/classes for each context (or melati jar to WEB-INF/lib/).</p>
  <h3>Upload Process</h3>
  <p>A limitation of the Upload Process was that the Melati / MelatiContext was 
    not set up before the file upload begun. This meant that the location where 
    the file is stored could not be manipulated depending on the User/Object/Field 
    currently in use. Additionally no Access check was made, potentilly causing 
    security problems. This has now been fixed.</p>
  <h3>Error Handling</h3>
  <p> You can now avoid Red Stacktrace Of Death effect when the user creates duplicate 
    keys </p>
  <p>If you have specialised org/melati/error.wm for your site, you will have 
    to rename your version to <tt>org/melati/template/webmacro/templets/html/error/java.lang.Exception.wm</tt></p>
  <p>org.melati.servlet.TemplateServlet has been changed to handle exception conditions 
    by searching for a templet named after the exception or a superclass, prefixed 
    by "error/". In general this winds up as </p>
  <p><tt>org/melati/template/webmacro/templets/html/error/java.lang.Exception.wm 
    </tt></p>
  <p>and that file has superseded the top level "error.wm" (now deleted from CVS). 
    The immediate purpose of this is to enable us to supply a specialised file 
  </p>
  <p><tt>org/melati/template/webmacro/templets/html/error/org.melati.poem.DuplicateKeySQLPoemException.wm 
    </tt></p>
  <p>for handling the case in which the user inserts or modifies a record in a 
    way which breaks index uniqueness (e.g. duplicate user name) without making 
    it seem as if the world has ended. </p>
  <p>The implementation leverages a new feature of (ClassName)TempletLoader: you 
    can optionally supply a "purpose" parameter, in this case "error", to direct 
    it to look in a subdirectory of the standard templet repository corresponding 
    to the purpose for which you want the templet. This makes it possible to use 
    class names for templets without messing up the namespace when you want to 
    do different things with the same class. </p>
  <p>&nbsp;</p>
  <hr>
  <p>&nbsp;</p>
  <h2>Release 0.54.2</h2>
  <h4>03/07/2001 </h4>
  <ul>
    <li>fix to default rendering of html elements - \n is translated to &lt;br&gt; 
      for elements that are displayed, but not if they are 'rendered for input'.</li>
    <li>please use WebMacro 0.98, as 0.97 has a bug which menas that AccessExceptions 
      do not always return a login page </li>
  </ul>
  <p>&nbsp;</p>
  <hr>
  <p>&nbsp;</p>
  <h2>Release 0.54.1</h2>
  <h4>20/06/2001 </h4>
  <ul>
    <li>fixes to templates and templets required for Webmacro 0.97. </li>
    <li>change to default rendering of html elements - \n is now translated to 
      &lt;br&gt;.</li>
  </ul>
  <p>&nbsp;</p>
  <hr>
  <p>&nbsp;</p>
  <h2>Release 0.54</h2>
  <h4>11/06/2001 </h4>
  <ul>
    <li>support for Webmacro 0.97. Previous versions of webmacro are no longer 
      supported. </li>
    <li>support for Velocity 1.1</li>
  </ul>
  <h3>WebMacro 0.97</h3>
  <ol>
    <li><b>Cleaning up.</b> We have removed all 'hacked' webmacro classes from 
      Melati. If you have any org.webmacro.* classes hanging arround, please ensure 
      you delete them.</li>
    <li><b>FastWriter. </b>FastWriter is now constructed with a Broker. So, you 
      will need to replace any construction (eg):<br>
      <tt>MelatiFastWriter(OutputStream output, String encoding)</tt> with<br>
      <tt>MelatiFastWriter(Broker broker, OutputStream output, String encoding) 
      </tt></li>
    <li><b>Exception Handling in Templates.</b> Melati sets a <tt>PropagateExceptionHandler</tt> 
      by default (forcing a logon page on encountering a <tt>AccessPoemException). 
      </tt>If you want to use a <tt>PassbackExceptionHandler</tt>, you <b>must</b> 
      set it in your template: <br>
      <tt>$melati.setVariableExceptionHandler($melati.PassbackVariableExceptionHandler). 
      </tt>Please ensure you check your Templates.</li>
    <li>Be careful with your templates (WM0.97 is not fully backward compatible). 
      Please see <a href="http://www.webmacro.org/SyntaxChanges">http://www.webmacro.org/SyntaxChanges</a>. 
      Run this command to see if you have problems; grep -H -n "\\$\(\\w*\\.*\)*;" 
      *.wm<tt> <br>
      </tt></li>
  </ol>
  <p>&nbsp;</p>
  <h3>Velocity</h3>
  <p>Melati now supports Velocity 1.1. </p>
  <ol>
    <li>At this stage, we don't ship any Velocity specific templates, instead 
      we translate the webmacro templates 'on the fly'. To do this, we override 
      the Velocity <tt>file.resource.loader.class </tt>with our own <tt>org.melati.template.velocity.WebMacroFileResourceLoader. 
      </tt>If a .vm template with the correct name is found it will be used, otherwise, 
      the .wm template will be loaded and translated.</li>
    <li>The template path for Velocity is set in <tt>org.melati.MelatiServlet.properties. 
      </tt>It may be a good idea to do this for WebMacro as well, but it wasn't 
      obvious how to do this, so it has been left for the time being.</li>
  </ol>
  <h3>&nbsp;</h3>
  <hr>
  <p>&nbsp;</p>
  <h2>Release 0.53.6</h2>
  <h4>09/04/2001 </h4>
  <ul>
    <li> 
      <p>Minor housekeeping release.</p>
    </li>
  </ul>
  <p>&nbsp;</p>
  <hr>
  <p>&nbsp;</p>
  <h2>Release 0.53.5</h2>
  <h4>23/03/2001 </h4>
  <p></p>
  <p></p>
  <p>0.53.5 introduces the following changes.</p>
  <ul>
    <li>DSDs can now be imported into other DSDs</li>
  </ul>
  <h3> Importing DSDs into other DSDs</h3>
  <p> You can now import DSDs into other DSDs. For instance, in my ImportBoards.dsd 
    I have a line:</p>
  <pre> import org.paneris.melati.boards.model.boards.dsd;</pre>
  <p> This adds all the tables defined in the <tt>boards.dsd</tt> file into my 
    ImportBoardsDatabase in such a way that you can access them in the same way 
    as any tables defined in ImportBoards.dsd. In particular, the objects in these 
    tables are instances of org.paneris.melati.boards.model.boards.* (i.e. any 
    custom code is available).</p>
  <p>All the imported tables are included into the new database. Note that all 
    Tables/Persistents are cast to the "base" table/persistent with the same name 
    - you will have to manually cast them to the correct type. Here "base" means 
    the oldest (nearest the root) base class. E.g. Poem.dsd defines User. boards.dsd 
    defines a new persistent, org.paneris.melati.boards.model.User (and ImportBoards.dsd 
    defines a org.paneris.melati.playing.importboards.User). If you call getUserTable() 
    on any of these databases you will get a org.melati.poem.User object (which 
    can be cast to org.paneris.melati.boards.User or org.paneris.melati.playing.importboards.User).</p>
  <h4> Changes required to projects:</h4>
  <p> 1) We no longer provide a getXxxxDatabase() function in each Table and Persistent. 
    Instead you should either just use getDatabase() or you can use getXxxxDatabaseTables() 
    to access tables specific to your project. In particular, getPoemDatabase() 
    is no longer available in the Poem tables/persisents. So if you call getPoemDatabase() 
    in your code, you should change it one of getDatabase() or getPoemDatabaseTables(). 
    Similarly, if you re-run DSD on your project Xxxx then you will need to handle 
    any calls to getXxxxDatabase(). You can either change them to getXxxxDatabaseTables(), 
    getDatabase(), or you can add the old function into your non-generated files: 
    e.g. in MyTable.java add:</p>
  <pre> XxxxDatabase getXxxxDatabase() { 

    (XxxxDatabase)getDatabase();

 }</pre>
  <p> 2) I have tested this on several databases and although I am fairly confident 
    that it should work, IF YOU RE-RUN DSD ON YOUR OWN DATABASES YOU MAY EXPERIENCE 
    PROBLEMS.</p>
  <p> 3) Your .dsd file must live in the same directory as your compiled code 
    because it is loaded as a Resource. </p>
  <p>&nbsp;</p>
  <hr>
  <p>&nbsp;</p>
  <h2>Release 0.53.4</h2>
  <h4>13/03/2001 </h4>
  <p>0.53.4 introduces the following changes.</p>
  <ul>
    <li>Support for Webmacro 0.95b3. Previous versions of webmacro are no longer 
      supported. </li>
    <li>Improved support for MS SQLServer</li>
  </ul>
  <p>This release patches the memory problems experienced with Webmacro previously.</p>
  <p>&nbsp;</p>
  <hr>
  <p>&nbsp;</p>
  <h2></h2>
  <h2>Release 0.53.3</h2>
  <h4>26/02/2001 </h4>
  <p>0.53.3 introduces the following changes.</p>
  <ul>
    <li>Support for Webmacro 2000-12-06. Previous versions of webmacro are no 
      longer supported. </li>
    <li>PoemTransaction monitoring, please see <tt><br>
      http://localhost/&lt;servlet zone&gt;/org.melati.poem.SessionAnalysisServlet</tt></li>
  </ul>
  <p>Please note, this is an experimental release. we have found problems with 
    Webmacro 2000-12-06 eating memory.</p>
  <p>&nbsp;</p>
  <hr>
  <p>&nbsp;</p>
  <h2></h2>
  <h2>Release 0.53.2.1</h2>
  <h4>01/03/2001 </h4>
  <p>Provides a workarround for the bug where Webmacro0.94 Fastwriter silently 
    failed to write context of &gt; 512 chars</p>
  <p>&nbsp;</p>
  <hr>
  <p>&nbsp;</p>
  <h2>Release 0.53</h2>
  <h4>13/02/2001 </h4>
  <p>0.53 introduces the following changes.</p>
  <ul>
    <li>support for Webmacro 0.94. Previous versions of webmacro are no longer 
      supported. </li>
    <li>improved file uploading (streaming to file, preventing &quot;out of memory&quot; 
      errors). </li>
    <li>cascading deletion in POEM</li>
  </ul>
  <p>&nbsp;</p>
  <h3>Webmacro 0.94</h3>
  <p> Webmacro 0.94 uses a FastWriter which writes to the underlying OutputStream. 
    It no longer uses a PrintWriter. So; Melati now has the following new classes: 
  </p>
  <p> <tt>abstract class MelatiWriter </tt>- for classes writing direct to the 
    Servlet (or another) OutputStream / Writer</p>
  <p><tt> class MelatiStringWriter extends MelatiWriter </tt>- for writing to 
    a String <tt><br>
    class MelatiSimpleWriter extends MelatiWriter </tt>- writes to a given Writer<tt><br>
    class MelatiBufferedWriter extends MelatiWriter </tt>- writes to a given Writer 
    (with buffering) </p>
  <p><tt><br>
    </tt>for using melati with webmacro: <tt><br>
    class MelatiFastWriter extends MelatiWriter </tt>- writes to a FastWriter 
    <tt><br>
    class MelatiBufferedFastWriter extends MelatiFastWriter</tt> - writes to a 
    FastWriter (with full buffering, output also available as a String) </p>
  <p><tt>melati.getWriter()</tt> will ask your template engine (if you have one) 
    for an appropiate writer, otherwise it will give you a<tt> SimpleMelatiWriter</tt> 
    or a <tt>BufferedMelatiWriter</tt> depending on if you have got buffering 
    on or off. <tt>MelatiWriter</tt> will also start a <tt>Flusher</tt> if appropiate. 
  </p>
  <p>The only API change you need to be aware of is the alternate constructor 
    for melati (for use in 'stand alone' mode) is now: </p>
  <p><tt>public Melati(MelatiConfig config, MelatiWriter writer) </tt></p>
  <p>If melati can't get an encoding from <tt>response.getCharacterEncoding()</tt>, 
    it uses the default "UFT8". </p>
  <p>&nbsp;</p>
  <h3>Improved Uploading</h3>
  <p>Access properties of an uploaded file (or "normal" form fields) through MultipartFormField. 
    Some of these properties are supplied by FormDataAdaptors which save each 
    field somehow (e.g. to memory or to a file). </p>
  <p>You can handle uploaded files how you want by supplying a FormDataAdaptorFactory 
    to MultipartDataDecoder. If you are using TemplateServlet then this is done 
    automatically for you: It uses the FormDataAdaptorFactory set in the MelatiConfig 
    (which can be set in org.melati.MelatiServlet.properties). You can override 
    the default in your TemplateServlet by doing something like: </p>
  <pre> protected MelatiConfig melatiConfig() throws MelatiException { 

     MelatiConfig config = super.melatiConfig(); 

     DefaultFileDataAdaptorFactory factory = new DefaultFileDataAdaptorFactory();      

     factory.setUploadDir("/tmp"); 

     config.setFormDataAdaptorFactory(factory); 

     return config; 

 } </pre>
  <p>For an example of how to parse an uploaded file manually, see org.melati.test.ConfigServletTest. 
    org.melati.test.TemplateServletTestWM also allows you to upload files. </p>
  <p>If you are using UploadURLPoemType.wm for the renderinfo for a field (so 
    you can upload files in Admin) then you need to make sure your FormDataAdaptorFactory 
    implements getURL (e.g. use PoemFileDataAdaptorFactory) </p>
  <p>In summary, then, the important classes (in org.melati.servlet) are: </p>
  <p><tt>MultipartDataDecoder</tt> - parses a Multipart form into<br>
    <tt>MultipartFormField </tt><br>
    <tt>MultipartFormField</tt> - allows access to properties of uploaded fields 
    (normal form fields and uploaded files) </p>
  <p><tt>FormDataAdaptor</tt> - tell us how "save" an uploaded field: <br>
    <tt>MemoryDataAdaptor</tt> - save the data in a byte array in memory <br>
    <tt>TemporyFileDataAdaptor</tt> - save the data to a temporary file <br>
    <tt>DefaultFileDataAdaptor</tt> - save the data in a (unique) file in the 
    given directory </p>
  <p><tt>FormDataAdaptorFactory</tt> - allows us to implement a policy for saving 
    uploaded files (not normal form fields)<br>
    <tt>MemoryDataAdaptorFactory</tt> - save all files in memory <br>
    <tt>TemporyFileDataAdaptorFactory</tt> - save all files to a temporary file 
    on disk <br>
    <tt>DefaultFileDataAdaptorFactory</tt> - save all files in a (unique) file 
    in the given directory <br>
    <tt>PoemFileDataAdaptorFactory</tt> - save all files to in a directory specified 
    in the database's setting table </p>
  <p>&nbsp;</p>
  <h3>Cascading Deletion in POEM</h3>
  <p> 0.53 has the following improvements to Melati's object deletion mechanism: 
  </p>
  <ul>
    <li> Facility for deleting referring objects, or NULLing out referring links, 
      rather than aborting the delete in order to maintain referential integrity. 
    </li>
    <li>Intra-transation delete (which can be rolled back): handier than deleteAndCommit.</li>
  </ul>
  <h4> <b>Action required/risk analysis </b></h4>
  <p>These changes have only been lightly tested, so administrators are advised 
    to try the updated system out before deploying it. </p>
  <p>In principle, no action is required unless you are a programmer and your 
    code overrides `Persistent.deleteAndCommit()'. In that case you should change 
    it to override the new `Persistent.delete(java.util.Map)' instead. </p>
  <p>If you wish to use `Persistent.delete()' in your code in future, you should 
    recreate the generated/*.java files from your application's DSD and recompile. 
    Otherwise there is an unlocked race condition which might cause loss of referential 
    integrity. Existing code which only calls `Persistent.deleteAndCommit()', 
    and does not override it, does not need to be recompiled. </p>
  <p>A new field is introduced into the `columninfo' table, but POEM's unification 
    mechanism will handle that automatically. (The field is nullable, so does 
    not need initialising.) </p>
  <p>Adding support for the intra-transaction delete method involved introducing 
    additional record locking in the case that a POEM thread creates a link to 
    an object but does not examine its contents. Previously this would not read-lock 
    the object; now it does. This is most unlikely to cause problems.</p>
  <h4>Detailed description </h4>
  <p> Flexible integrity fixes </p>
  <p>Previously, if there were objects in the database containing references to 
    the object to be deleted, the deletion would simply fail. That is still the 
    default, but two alternative behaviours are now also available: NULL out the 
    offending links, or delete the linking objects too. The policy followed is 
    configurable for each referring column in the database, so that ephemeral 
    records associated with a master object can be set selectively to auto-delete 
    rather than inappropriately obstruct deletion of the parent. </p>
  <p>To make a link delete its source when its target is deleted o in the DSD: 
  </p>
  <ul>
    <li>use "(integrityfix = delete)". For instance,<br>
      <tt>table BookStocking (description = "A record that a bookshop stocks a 
      book") {<br>
      (primary) Integer id; Bookshop shop (description = "The bookshop"); <br>
      Book book (description = "The stocked book") (integrityfix = delete); ... 
      <br>
      } </tt><br>
      The BookStocking record will be removed transparently if its `book' is deleted, 
      but will (defaulting to the standard behaviour) prevent deletion of its 
      `shop'. </li>
    <li> via the admin system: find the column in the `Column' metadata table, 
      and set its `Integrity fix' field to `delete' </li>
    <li> via POEM directly: column.setIntegrityFix(StandardIntegrityFix.delete); 
    </li>
  </ul>
  <p>To make the link instead NULL itself out, use `clear' rather than `delete'. 
  </p>
  <p>Applications programmers are also able to override these settings for each 
    individual delete operation, by passing an optional argument to the `Persistent.delete' 
    method. </p>
  <h4> Cancellable intra-transaction deletes </h4>
  <p>The new `Persistent.delete' method differs from the existing `Persistent.deleteAndCommit' 
    in that (a) it does not wait for exclusive access to the database before attempting 
    to delete the object, and (b) it does not perform a `commit' (`rollback') 
    immediately upon (un)successful completion. This means that it can be rolled 
    back later if necessary, and makes it more like the normal get/set/create 
    operations. Both methods will remain for now, and both support the new, more 
    flexible integrity maintenance scheme. </p>
  <p>&nbsp;</p>
  <hr>
  <p>&nbsp;</p>
  <h2>Release 0.52.1</h2>
  <h4>21//01/2001 </h4>
  <p>The main motivation for this release is to seperate the Java doc from the 
    rest of the code so that each can be downloaded seperately. The JavaDocs are 
    no longer in CVS, but are available on the website for browsing and download. 
  </p>
  <p>Additionally, the following changes are included.</p>
  <ul>
    <li>ability to override Melati Config settings.</li>
    <li>support for BINARY types in POEM</li>
  </ul>
  <p>&nbsp;</p>
  <h2>Release 0.52</h2>
  <h4>18/01/2001 </h4>
  <h3>Introduction</h3>
  <p>This release involves a major overhaul of the Melati servlet API and templet 
    API. </p>
  <p>This has been done to provide the following:</p>
  <ul>
    <li>a cleaner Servlet API that allows more flexible interaction with Melati, 
      notable the ability to use Melati outside of a POEM Session</li>
    <li>a cleaner relationship with Webmacro, allowing us to plug in other Template 
      Engines, and to prepare the code to provide support the latest WebMacro 
      release (0.95). Note, this release still only supports the July 19, 2000 
      WebMacro snapshot. </li>
  </ul>
  <p>This release does not introduce any significant new functionality, but does 
    provide an API against which this can be done. Some minor new functaionality 
    has been added:</p>
  <ul>
    <li>File upload</li>
    <li>Melati Test suite</li>
  </ul>
  <p>&nbsp;</p>
  <p>&nbsp;</p>
  <h3>Warning</h3>
  <ul>
    <li>You existing 0.50 applications will not work with this release</li>
  </ul>
  <p>&nbsp;</p>
  <h3>The new Servlet API</h3>
  <p><tt>MelatiServlet</tt> and <tt>MelatiWMServlet</tt> have been removed, and 
    have been replaced by the following hierarchy:</p>
  <p><tt>org.melati.servlet.ConfigServlet extends HttpServlet<br>
    org.melati.servlet.PoemServlet extends ConfigServlet<br>
    </tt><tt>org.melati.servlet.TemplateServlet extends PoemServlet<br>
    org.melati.template.webmacro.WebmacroMelatiServlet extends TemplateServlet<br>
    </tt></p>
  <p>These are explained in more detail here:</p>
  <h4>&nbsp;</h4>
  <h4><tt>org.melati.servlet.ConfigServlet</tt></h4>
  <p>This simply creates a <tt>Melati</tt> using the configuration given in <tt>org.melati.MelatiServlet.properties</tt>, 
    and a <tt>MelatiContext.</tt> The PathInfo is parsed to provide a 'Method'. 
    Extending ConfigServlet is useful when writing servlets that do no want to 
    run entirely within a POEM Session. Eg, a servlet that does a lengthy task 
    not associated with POEM (like streaming a download) could tie up POEM Transactions 
    for a long time unnecessarily.</p>
  <p>To use ConfigServlet, implement:</p>
  <p> <tt>protected abstract void doConfiguredRequest(Melati melati) throws Exception; 
    </tt></p>
  <p>&nbsp;</p>
  <p><tt><b>org.melati.servlet.PoemServlet</b></tt></p>
  <p>This does further parsing of the PathInfo into MelatiContext in order to 
    provide a <tt>LogicalDatabase</tt>, <tt>Table</tt> and <tt>Troid</tt>. It 
    then sets up a POEM Session (using the configuration given in <tt>org.melati.LogicalDatabase.properties</tt>.). 
    PoemServlet is useful when you want to do build servlets without a Template 
    Engine getting in the way. Eg, you want direct access to the Servlet Request, 
    or want control over the response (using say Response.OutputStream).</p>
  <p>To use PoemServlet, implement:</p>
  <p> <tt>protected abstract void doPoemRequest(Melati melati) throws Exception; 
    </tt></p>
  <p>&nbsp;</p>
  <p><tt><b>org.melati.servlet.TemplateServlet</b></tt></p>
  <p>This initialises the Template Engine (given in <tt>org.melati.MelatiServlet.properties). 
    </tt>TemplateServlet is used as the base servlet for generic Melati Servlets 
    eg Admin, Login.</p>
  <p>To use TemplateServlet, implement:</p>
  <p> <tt> protected abstract String doTemplateRequest(Melati melati, TemplateContext 
    context) throws Exception; </tt></p>
  <p>You should return the template name without the extension which is added 
    by the <tt><b>TemplateServlet</b></tt></p>
  <p>&nbsp;</p>
  <p><tt><b>org.melati.template.webmacro.WebmacroTemplateServlet</b></tt></p>
  <p>This is provided for convenience. It simply provides an API for using melati 
    with WebMacro. This API is a little different from the 0.50 <tt>MelatiServlet</tt> 
    API. to use </p>
  <p> <tt>public abstract String handle( Melati melati, WebContext webContext 
    ) throws Exception; </tt></p>
  <p>So, instead of returning a template, simply return the template name (including 
    the extension).</p>
  <p>&nbsp;</p>
  <h3>Changes to the Packages</h3>
  <p>Some stuff has been moved, and new packages have been created:</p>
  <p>&nbsp;</p>
  <p><tt><b>org.melati.template</b></tt></p>
  <p>This now contains the Template Engine Interface code (see below). It also 
    contains <tt><b>org.melati.template.webmacro</b> and <b>org.melati.template.jtemplater. 
    </b></tt>Package<b> </b><tt><b>org.melati.template</b></tt> also now contains 
    <b> <tt>MarkupLanguage</tt></b> and associated classes.</p>
  <p>&nbsp;</p>
  <p><tt><b>org.melati.templet</b></tt></p>
  <p>Has gone. Everything has been moved to <tt><b>org.melati.template</b></tt>. 
    It was basically too confusing to have packages with such similar names, and 
    they are very intertwined anyway.</p>
  <p>&nbsp;</p>
  <p><tt><b>org.melati.servlet</b></tt></p>
  <p>Has the generic classes that implement <tt><b>HttpServlet</b></tt>. Also 
    now contains <tt><b>MelatiContext</b></tt>.</p>
  <p></p>
  <p></p>
  <p>&nbsp;</p>
  <p><tt><b>org.melati.test</b></tt></p>
  <p>Has some nice servlets that allow you to test your installation. Bloody useful. 
  </p>
  <p>&nbsp;</p>
  <h3>Key Objects</h3>
  <p>The objects used by Melati have changed a bit, here are the important ones</p>
  <p>&nbsp;</p>
  <p><tt><b>org.melati.MelatiConfig</b></tt></p>
  <p>This loads in <tt>org.melati.Melatiservlet.properties. </tt> Importantly 
    it allows you to get a <tt><b>Melati</b></tt> ;</p>
  <p> <tt>public Melati getContext(HttpServletRequest request, HttpServletResponse 
    response) throws MelatiException </tt></p>
  <p>&nbsp;</p>
  <p></p>
  <p></p>
  <p></p>
  <p></p>
  <p></p>
  <p><tt><b>org.melati.Melati</b></tt></p>
  <p>This is where everything happens, it does all the usual stuff (access to 
    the servlet API) and much of what was in <tt>org.melati.Melati</tt><tt>. </tt> 
    Importantly, is also has:</p>
  <p></p>
  <p> <tt>public Writer getWriter() throws IOException;</tt><br>
  </p>
  <p>This give you access to the output stream at all times. By default, this 
    is fully buffered, but you can turn this off completely or use a <tt>ThrowingPrintWriter</tt> 
    which periodically flushes. Templets are now expanded directly to the output 
    stream without haveing to be buffered in strings first.</p>
  <p>&nbsp;</p>
  <p></p>
  <p></p>
  <p><tt><b>org.melati.MelatiContext</b></tt></p>
  <p>This is unchanged.</p>
  <p>&nbsp; </p>
  <p> </p>
  <p></p>
  <p><tt><b>org.melati.template.TemplateContext</b></tt></p>
  <p></p>
  <p></p>
  <p></p>
  <p>This is the interface to the context against which your templates / templets 
    are expanded. It provides <tt>get</tt> and <tt>set</tt> methods that (in the 
    case of WebMacro) map directly onto the <tt>WebContext</tt><br>
  </p>
  <p></p>
  <p><br>
  </p>
  <p></p>
  <p></p>
  <p></p>
  <p></p>
  <p> </p>
  <p></p>
  <p></p>
  <h3>Changes to .properties</h3>
  <h3></h3>
  <p>You will need to add the following line to<tt> org.melati.Melatiservlet.properties</tt></p>
  <p><tt>org.melati.MelatiServlet.templateEngine=org.melati.template.webmacro.WebmacroTemplateEngine 
    </tt></p>
  <p>Also, if you have an entry for TempletLoader, it should now read:</p>
  <p><tt>org.melati.MelatiServlet.templetLoader=org.melati.template.ClassNameTempletLoader 
    </tt></p>
  <p>And javascriptLibraryURL should read</p>
  <p><tt>org.melati.MelatiServlet.javascriptLibraryURL=/melati-static/template/webmacro/templets/html</tt></p>
  <p>(although it is not clear that it belongs here)</p>
  <p>&nbsp;</p>
  <h3>Exception Handling</h3>
  <p>I believe that exceptions are now presented better. Any exception that is 
    not part of the Initialisation process should now be presented with a full 
    stack trace to the browser, and logged with a full stack trace to <tt>System.err. 
    </tt>If you get a Server Error, it means you have a problem in the initialisation 
    and you need to review the error_log.</p>
  <p></p>
  <p><br>
  </p>
  <h3>What has not been done</h3>
  <ul>
    <li> source code documentation (some has been done) </li>
    <li>complete seperation from WebMacro (we are still using the hacked Variable 
      stuff), but this should be possible when we introduce WebMacro 0.95</li>
  </ul>
  <p>&nbsp;</p>
  <h3>Installation Instructions</h3>
  <p>Follow the <a href="README.html#Installation">usual instructions</a> and 
    then open:</p>
  <p><tt>http://localhost/&lt;servlet zone&gt;/org.melati.test.ConfigServletTest/</tt></p>
  <p>This should lead you through testing Melati and allow you to debug your installation 
    easily.<br>
    <br>
    <br>
  </p>
  <p></p>
  <p> </p>
  <p></p>
  <p></p>
  <p></p>
  <p></p>
  <p> </p>
  <p></p>
  <p> </p>
  <p></p>
  <p></p>
  <p></p>
  <hr>
  <p>&nbsp; </p>
  <p> 
  <h2>Release 0.50 </h2>
  <h3>23/11/2000 </h3>
  <p> This is the first public beta release of Melati. 
  <p>Melati has been used as Alpha software for over 9 months, and there are several 
    sites in production. 
  <p>This beta release offers the following improvements over Alpha versions of 
    Melati: 
  <ul>
    <li>Testing and numerous bug fixes</li>
    <li>Now available as a downloadable zip / tar.gz. </li>
    <li>Precompiled melati-snapshot.jar allowing easier install.</li>
    <li>Ant build script</li>
    <li>Mailing list hosted on SourceForge</li>
    <li>More documentation</li>
    <li>Revised licensing - Dual ASF / GPL licensing.</li>
  </ul>
  <p> See the LICENSE.txt file for details about your rights and obligations with 
    respect to the software, plus legal disclaimers, and so forth. 
  <h4>Upgrading from Melati Alpha Software</h4>
  <p>Please follow the <a href="README.html#Installation">Installation instructions</a>. 
  <p>&nbsp; 
</blockquote>
</body></html>





