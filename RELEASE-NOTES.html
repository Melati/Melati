<html><head>
<title>Melati Release Notes</title>
</head>

<body bgcolor="white">
<blockquote> 
  <h1 align="center">The Melati Project </h1>
  <h3 align="center">Release Notes </h3>
  <h4 align="center">last updated 06/02/2001 - tim@hoop.co.uk</h4>
  <h2>Release 0.53</h2>
  <h4>06/02/2001 </h4>
  <p>0.53 introduces the following changes.</p>
  <ul>
    <li>support for Webmacro 0.94. Previous versions of webmacro are no longer 
      supported. </li>
    <li>better file uploading (streaming to file, preventing &quot;out of memory&quot; 
      errors). </li>
  </ul>
  <p> Webmacro 0.94 uses a FastWriter which writes to the underlying OutputStream. 
    It no longer uses a PrintWriter. So; Melati now has the following new classes: 
  </p>
  <p><tt>interface MelatiWriter</tt> - for classes writing direct to the Servlet 
    (or another) OutputStream / Writer<br>
    <tt>interface MelatiStringWriter</tt> - for writing to a String </p>
  <p><tt>class SimpleMelatiWriter</tt> - writes to a given Writer<br>
    <tt>class BufferedMelatiWriter</tt> 
    - writes to a given Writer (with buffering) <br>
    <tt>class SimpleStringMelatiWriter </tt>- to get Melati output as a string 
  </p>
  <p>for using melati with webmacro: <br>
    <tt>class FastMelatiWriter</tt> - writes to a FastWriter (with full buffering) 
    <br>
    <tt>class FastStringMelatiWriter</tt> - writes to a FastWriter (output available 
    as a String) </p>
  <p><tt>melati.getWriter()</tt> will ask your template engine (if you have one) 
    for an appropiate writer, otherwise it will give you a<tt> SimpleMelatiWriter</tt> 
    or a <tt>BufferedMelatiWriter</tt> depending on if you have got buffering 
    on or off. It will also start a <tt>Flusher</tt> if appropiate. </p>
  <p>The only API change you need to be aware of is the alternate constructor 
    for melati (for use in 'stand alone' mode) is now: </p>
  <p><tt>public Melati(MelatiConfig config, MelatiWriter writer) </tt></p>
  <p>If melati can't get an encoding from <tt>response.getCharacterEncoding()</tt>, 
    it uses the default "UFT8". </p>
  <p>&nbsp;</p>
  <h2>Release 0.52.1</h2>
  <h4>21//01/2001 </h4>
  <p>The main motivation for this release is to seperate the Java doc from the 
    rest of the code so that each can be downloaded seperately. The JavaDocs are 
    no longer in CVS, but are available on the website for browsing and download. 
  </p>
  <p>Additionally, the following changes are included.</p>
  <ul>
    <li>ability to override Melati Config settings.</li>
    <li>support for BINARY types in POEM</li>
  </ul>
  <p>&nbsp;</p>
  <p>&nbsp;</p>
  <h2>Release 0.52</h2>
  <h4>18/01/2001 </h4>
  <h3>Introduction</h3>
  <p>This release involves a major overhaul of the Melati servlet API and templet 
    API. </p>
  <p>This has been done to provide the following:</p>
  <ul>
    <li>a cleaner Servlet API that allows more flexible interaction with Melati, 
      notable the ability to use Melati outside of a POEM Session</li>
    <li>a cleaner relationship with Webmacro, allowing us to plug in other Template 
      Engines, and to prepare the code to provide support the latest WebMacro 
      release (0.95). Note, this release still only supports the July 19, 2000 
      WebMacro snapshot. </li>
  </ul>
  <p>This release does not introduce any significant new functionality, but does 
    provide an API against which this can be done. Some minor new functaionality 
    has been added:</p>
  <ul>
    <li>File upload</li>
    <li>Melati Test suite</li>
  </ul>
  <p>&nbsp;</p>
  <p>&nbsp;</p>
  <h3>Warning</h3>
  <ul>
    <li>You existing 0.50 applications will not work with this release</li>
  </ul>
  <p>&nbsp;</p>
  <h3>The new Servlet API</h3>
  <p><tt>MelatiServlet</tt> and <tt>MelatiWMServlet</tt> have been removed, and 
    have been replaced by the following hierarchy:</p>
  <p><tt>org.melati.servlet.ConfigServlet extends HttpServlet<br>
    org.melati.servlet.PoemServlet extends ConfigServlet<br>
    </tt><tt>org.melati.servlet.TemplateServlet extends PoemServlet<br>
    org.melati.template.webmacro.WebmacroMelatiServlet extends TemplateServlet<br>
    </tt></p>
  <p>These are explained in more detail here:</p>
  <h4>&nbsp;</h4>
  <h4><tt>org.melati.servlet.ConfigServlet</tt></h4>
  <p>This simply creates a <tt>Melati</tt> using the configuration given in <tt>org.melati.MelatiServlet.properties</tt>, 
    and a <tt>MelatiContext.</tt> The PathInfo is parsed to provide a 'Method'. 
    Extending ConfigServlet is useful when writing servlets that do no want to 
    run entirely within a POEM Session. Eg, a servlet that does a lengthy task 
    not associated with POEM (like streaming a download) could tie up POEM Transactions 
    for a long time unnecessarily.</p>
  <p>To use ConfigServlet, implement:</p>
  <p> <tt>protected abstract void doConfiguredRequest(Melati melati) throws Exception; 
    </tt></p>
  <p>&nbsp;</p>
  <p><tt><b>org.melati.servlet.PoemServlet</b></tt></p>
  <p>This does further parsing of the PathInfo into MelatiContext in order to 
    provide a <tt>LogicalDatabase</tt>, <tt>Table</tt> and <tt>Troid</tt>. It 
    then sets up a POEM Session (using the configuration given in <tt>org.melati.LogicalDatabase.properties</tt>.). 
    PoemServlet is useful when you want to do build servlets without a Template 
    Engine getting in the way. Eg, you want direct access to the Servlet Request, 
    or want control over the response (using say Response.OutputStream).</p>
  <p>To use PoemServlet, implement:</p>
  <p> <tt>protected abstract void doPoemRequest(Melati melati) throws Exception; 
    </tt></p>
  <p>&nbsp;</p>
  <p><tt><b>org.melati.servlet.TemplateServlet</b></tt></p>
  <p>This initialises the Template Engine (given in <tt>org.melati.MelatiServlet.properties). 
    </tt>TemplateServlet is used as the base servlet for generic Melati Servlets 
    eg Admin, Login.</p>
  <p>To use TemplateServlet, implement:</p>
  <p> <tt> protected abstract String doTemplateRequest(Melati melati, TemplateContext 
    context) throws Exception; </tt></p>
  <p>You should return the template name without the extension which is added 
    by the <tt><b>TemplateServlet</b></tt></p>
  <p>&nbsp;</p>
  <p><tt><b>org.melati.template.webmacro.WebmacroTemplateServlet</b></tt></p>
  <p>This is provided for convenience. It simply provides an API for using melati 
    with WebMacro. This API is a little different from the 0.50 <tt>MelatiServlet</tt> 
    API. to use </p>
  <p> <tt>public abstract String handle( Melati melati, WebContext webContext 
    ) throws Exception; </tt></p>
  <p>So, instead of returning a template, simply return the template name (including 
    the extension).</p>
  <p>&nbsp;</p>
  <h3>Changes to the Packages</h3>
  <p>Some stuff has been moved, and new packages have been created:</p>
  <p>&nbsp;</p>
  <p><tt><b>org.melati.template</b></tt></p>
  <p>This now contains the Template Engine Interface code (see below). It also 
    contains <tt><b>org.melati.template.webmacro</b> and <b>org.melati.template.jtemplater. 
    </b></tt>Package<b> </b><tt><b>org.melati.template</b></tt> also now contains 
    <b> <tt>MarkupLanguage</tt></b> and associated classes.</p>
  <p>&nbsp;</p>
  <p><tt><b>org.melati.templet</b></tt></p>
  <p>Has gone. Everything has been moved to <tt><b>org.melati.template</b></tt>. 
    It was basically too confusing to have packages with such similar names, and 
    they are very intertwined anyway.</p>
  <p>&nbsp;</p>
  <p><tt><b>org.melati.servlet</b></tt></p>
  <p>Has the generic classes that implement <tt><b>HttpServlet</b></tt>. Also 
    now contains <tt><b>MelatiContext</b></tt>.</p>
  <p></p>
  <p></p>
  <p>&nbsp;</p>
  <p><tt><b>org.melati.test</b></tt></p>
  <p>Has some nice servlets that allow you to test your installation. Bloody useful. 
  </p>
  <p>&nbsp;</p>
  <h3>Key Objects</h3>
  <p>The objects used by Melati have changed a bit, here are the important ones</p>
  <p>&nbsp;</p>
  <p><tt><b>org.melati.MelatiConfig</b></tt></p>
  <p>This loads in <tt>org.melati.Melatiservlet.properties. </tt> Importantly 
    it allows you to get a <tt><b>Melati</b></tt> ;</p>
  <p> <tt>public Melati getContext(HttpServletRequest request, HttpServletResponse 
    response) throws MelatiException </tt></p>
  <p>&nbsp;</p>
  <p></p>
  <p></p>
  <p></p>
  <p></p>
  <p></p>
  <p><tt><b>org.melati.Melati</b></tt></p>
  <p>This is where everything happens, it does all the usual stuff (access to 
    the servlet API) and much of what was in <tt>org.melati.Melati</tt><tt>. </tt> 
    Importantly, is also has:</p>
  <p></p>
  <p> <tt>public Writer getWriter() throws IOException;</tt><br>
  </p>
  <p>This give you access to the output stream at all times. By default, this 
    is fully buffered, but you can turn this off completely or use a <tt>ThrowingPrintWriter</tt> 
    which periodically flushes. Templets are now expanded directly to the output 
    stream without haveing to be buffered in strings first.</p>
  <p>&nbsp;</p>
  <p></p>
  <p></p>
  <p><tt><b>org.melati.MelatiContext</b></tt></p>
  <p>This is unchanged.</p>
  <p>&nbsp; </p>
  <p> </p>
  <p></p>
  <p><tt><b>org.melati.template.TemplateContext</b></tt></p>
  <p></p>
  <p></p>
  <p></p>
  <p>This is the interface to the context against which your templates / templets 
    are expanded. It provides <tt>get</tt> and <tt>set</tt> methods that (in the 
    case of WebMacro) map directly onto the <tt>WebContext</tt><br>
  </p>
  <p></p>
  <p><br>
  </p>
  <p></p>
  <p></p>
  <p></p>
  <p></p>
  <p> </p>
  <p></p>
  <p></p>
  <h3>Changes to .properties</h3>
  <h3></h3>
  <p>You will need to add the following line to<tt> org.melati.Melatiservlet.properties</tt></p>
  <p><tt>org.melati.MelatiServlet.templateEngine=org.melati.template.webmacro.WebmacroTemplateEngine 
    </tt></p>
  <p>Also, if you have an entry for TempletLoader, it should now read:</p>
  <p><tt>org.melati.MelatiServlet.templetLoader=org.melati.template.ClassNameTempletLoader 
    </tt></p>
  <p>And javascriptLibraryURL should read</p>
  <p><tt>org.melati.MelatiServlet.javascriptLibraryURL=/melati-static/template/webmacro/templets/html</tt></p>
  <p>(although it is not clear that it belongs here)</p>
  <p>&nbsp;</p>
  <h3>Exception Handling</h3>
  <p>I believe that exceptions are now presented better. Any exception that is 
    not part of the Initialisation process should now be presented with a full 
    stack trace to the browser, and logged with a full stack trace to <tt>System.err. 
    </tt>If you get a Server Error, it means you have a problem in the initialisation 
    and you need to review the error_log.</p>
  <p></p>
  <p><br>
  </p>
  <h3>What has not been done</h3>
  <ul>
    <li> source code documentation (some has been done) </li>
    <li>complete seperation from WebMacro (we are still using the hacked Variable 
      stuff), but this should be possible when we introduce WebMacro 0.95</li>
  </ul>
  <p>&nbsp;</p>
  <h3>Installation Instructions</h3>
  <p>Follow the <a href="README.html#Installation">usual instructions</a> and 
    then open:</p>
  <p><tt>http://localhost/&lt;servlet zone&gt;/org.melati.test.ConfigServletTest/</tt></p>
  <p>This should lead you through testing Melati and allow you to debug your installation 
    easily.<br>
    <br>
    <br>
  </p>
  <p></p>
  <p> </p>
  <p></p>
  <p></p>
  <p></p>
  <p></p>
  <p> </p>
  <p></p>
  <p> </p>
  <p></p>
  <p></p>
  <p></p>
  <hr>
  <p>&nbsp; </p>
  <p> 
  <h2>Release 0.50 </h2>
  <h3>23/11/2000 </h3>
  <p> This is the first public beta release of Melati. 
  <p>Melati has been used as Alpha software for over 9 months, and there are several 
    sites in production. 
  <p>This beta release offers the following improvements over Alpha versions of 
    Melati: 
  <ul>
    <li>Testing and numerous bug fixes</li>
    <li>Now available as a downloadable zip / tar.gz. </li>
    <li>Precompiled melati-snapshot.jar allowing easier install.</li>
    <li>Ant build script</li>
    <li>Mailing list hosted on SourceForge</li>
    <li>More documentation</li>
    <li>Revised licensing - Dual ASF / GPL licensing.</li>
  </ul>
  <p> See the LICENSE.txt file for details about your rights and obligations with 
    respect to the software, plus legal disclaimers, and so forth. 
  <h4>Upgrading from Melati Alpha Software</h4>
  <p>Please follow the <a href="README.html#Installation">Installation instructions</a>. 
  <p>&nbsp; 
</blockquote>
</body></html>


